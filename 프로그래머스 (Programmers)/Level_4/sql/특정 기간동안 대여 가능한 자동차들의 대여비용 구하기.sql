SELECT DISTINCT C.CAR_ID,C.CAR_TYPE, 
ROUND(30*C.DAILY_FEE*(100-P.DISCOUNT_RATE)/100,0) AS FEE
FROM CAR_RENTAL_COMPANY_CAR C
JOIN CAR_RENTAL_COMPANY_DISCOUNT_PLAN P
ON C.CAR_TYPE=P.CAR_TYPE
WHERE C.CAR_TYPE IN ('세단','SUV')
AND C.CAR_ID NOT IN 
    (SELECT DISTINCT(C.CAR_ID)
    FROM CAR_RENTAL_COMPANY_RENTAL_HISTORY H
    JOIN CAR_RENTAL_COMPANY_CAR C
    ON H.CAR_ID=C.CAR_ID
    WHERE ( DATE('2022-11-01') BETWEEN H.START_DATE AND H.END_DATE
    OR DATE('2022-11-30')  BETWEEN H.START_DATE AND H.END_DATE
    OR H.START_DATE  BETWEEN DATE('2022-11-01') AND DATE('2022-11-30')
    OR H.END_DATE  BETWEEN DATE('2022-11-01') AND DATE('2022-11-30')))
AND P.DURATION_TYPE LIKE '30%'
AND C.CAR_TYPE=P.CAR_TYPE
AND 500000<=ROUND(30*C.DAILY_FEE*(100-P.DISCOUNT_RATE)/100,0)
AND ROUND(30*C.DAILY_FEE*(100-P.DISCOUNT_RATE)/100,0)<2000000
ORDER BY FEE DESC, C.CAR_TYPE ASC, C.CAR_ID DESC
